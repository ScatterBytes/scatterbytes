<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>scatterbytes.cli &mdash; ScatterBytes 0.9.14 documentation</title>
    
    <link rel="stylesheet" href="../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.9.14',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="ScatterBytes 0.9.14 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../../index.html">
          <span>ScatterBytes 0.9.14 documentation</span></a></h1>
        <h2 class="heading"><span>scatterbytes.cli</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for scatterbytes.cli</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Command Line Interface functionality</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">logging.handlers</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">daemon</span>
    <span class="c"># called pidlockfile in standard debian distro</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">daemon.pidfile</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">daemon.pidlockfile</span>
        <span class="n">daemon</span><span class="o">.</span><span class="n">pidfile</span> <span class="o">=</span> <span class="n">daemon</span><span class="o">.</span><span class="n">pidlockfile</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">daemon</span> <span class="o">=</span> <span class="bp">None</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
<span class="kn">import</span> <span class="nn">argcomplete</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">errors</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">validation</span>


<span class="n">PID_PATH_DF</span> <span class="o">=</span> <span class="s">&#39;/var/run/scatterbytes/scatterbytes-server.pid&#39;</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c"># Several imports are performed as needed to prevent loading uneeded modules.</span>

<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>


<div class="viewcode-block" id="PrettyProxy"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.PrettyProxy">[docs]</a><span class="k">class</span> <span class="nc">PrettyProxy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;wrapper with nicer output&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proxy</span> <span class="o">=</span> <span class="n">proxy</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="s">&quot;print nice output for a recognized error&quot;</span>
        <span class="c">#if name.startswith(&#39;get_account&#39;):</span>
        <span class="c">#    import pdb; pdb.set_trace()</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
            <span class="c"># wrap call to check output</span>
            <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">attr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">SBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">e</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">print</span> <span class="n">out</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new</span>
        <span class="k">elif</span> <span class="n">attr</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">attr</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="create_client_node"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.create_client_node">[docs]</a><span class="k">def</span> <span class="nf">create_client_node</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c"># wrapper to prevent multiple re-imports</span>
    <span class="kn">from</span> <span class="nn">.client.jsonrpc</span> <span class="kn">import</span> <span class="n">create_client_node</span>
    <span class="n">client_node</span> <span class="o">=</span> <span class="n">create_client_node</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">PrettyProxy</span><span class="p">(</span><span class="n">client_node</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="create_storage_node"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.create_storage_node">[docs]</a><span class="k">def</span> <span class="nf">create_storage_node</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c"># wrapper to prevent multiple re-imports</span>
    <span class="kn">from</span> <span class="nn">.storage.jsonrpc</span> <span class="kn">import</span> <span class="n">create_storage_node</span>
    <span class="n">storage_node</span> <span class="o">=</span> <span class="n">create_storage_node</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">PrettyProxy</span><span class="p">(</span><span class="n">storage_node</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="start_server"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.start_server">[docs]</a><span class="k">def</span> <span class="nf">start_server</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>

    <span class="kn">from</span> <span class="nn">.storage.jsonrpc</span> <span class="kn">import</span> <span class="n">start_server</span> <span class="k">as</span> <span class="n">start_storage_server</span>

    <span class="n">daemonize</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">nodaemon</span>

    <span class="n">start_storage_server</span><span class="p">(</span><span class="n">daemonize</span><span class="o">=</span><span class="n">daemonize</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_daemon_pid"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.get_daemon_pid">[docs]</a><span class="k">def</span> <span class="nf">get_daemon_pid</span><span class="p">(</span><span class="n">storage_node_config_path</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">PID_PATH_DF</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">PID_PATH_DF</span>
    <span class="c"># need to read the config</span>
    <span class="kn">from</span> <span class="nn">.storage.node</span> <span class="kn">import</span> <span class="n">StorageNodeConfig</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">StorageNodeConfig</span><span class="p">(</span><span class="n">storage_node_config_path</span><span class="p">)</span>
    <span class="n">pid_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">data_directory</span><span class="p">,</span> <span class="s">&#39;sbnet.pid&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pid_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pid_path</span>

</div>
<div class="viewcode-block" id="check_yesno"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.check_yesno">[docs]</a><span class="k">def</span> <span class="nf">check_yesno</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;yes&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">response</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;yes&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;yes&#39;</span>
    <span class="k">if</span> <span class="n">response</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;no&#39;</span><span class="p">,</span> <span class="s">&#39;n&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;no&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">return</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="input_yesno"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.input_yesno">[docs]</a><span class="k">def</span> <span class="nf">input_yesno</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;yes&#39;</span><span class="p">):</span>
    <span class="c"># loop until get a proper response</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span> <span class="o">+</span> <span class="s">&#39; (y/n, default </span><span class="si">%s</span><span class="s">): &#39;</span> <span class="o">%</span> <span class="n">default</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">while</span> <span class="n">response</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">check_yesno</span><span class="p">(</span><span class="nb">raw_input</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">default</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>

</div>
<div class="viewcode-block" id="prompt_register"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.prompt_register">[docs]</a><span class="k">def</span> <span class="nf">prompt_register</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
        <span class="n">client_node</span> <span class="o">=</span> <span class="n">create_client_node</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client_node</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">node_type</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;errors&#39;</span><span class="p">]:</span>
            <span class="k">print</span>
            <span class="k">print</span> <span class="s">&#39;The following errors are present:&#39;</span>
            <span class="k">print</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">print</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">print</span>
            <span class="k">if</span> <span class="n">input_yesno</span><span class="p">(</span><span class="s">&#39;Do you want to try agian?&#39;</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;yes&#39;</span><span class="p">:</span>
                <span class="n">prompt_register</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c"># no errors - proceed</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;node_id&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;node_info&#39;</span><span class="p">][</span><span class="s">&#39;node_id&#39;</span><span class="p">])</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;recert_code&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;node_info&#39;</span><span class="p">][</span><span class="s">&#39;recert_code&#39;</span><span class="p">])</span>
        <span class="n">config</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">print</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Account creation successful. Press [Enter] to continue: &#39;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="c"># what type of config is this?</span>
    <span class="k">if</span> <span class="s">&#39;client&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">node_type</span> <span class="o">=</span> <span class="s">&#39;client&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">node_type</span> <span class="o">=</span> <span class="s">&#39;storage&#39;</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Your Node ID is not set. If you do not already have a &#39;</span>
           <span class="s">&#39;Node ID, you can register now. Do you want to register &#39;</span>
           <span class="s">&#39;now?&#39;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">input_yesno</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;yes&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="s">&#39;no&#39;</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s">&#39;storage&#39;</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Storage Nodes have the option of anonymous registration. &#39;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;This is the quickest way to get started, but it will not &#39;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;create an account for access through the website. &#39;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;Do you want to use anonymous registration?&#39;</span>
        <span class="k">print</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">input_yesno</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;yes&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="s">&#39;yes&#39;</span><span class="p">:</span>
            <span class="n">email</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">password</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span> <span class="n">register</span><span class="p">()</span>

    <span class="k">print</span>
    <span class="k">print</span> <span class="s">&#39;The following information is needed to register:&#39;</span>
    <span class="k">print</span>
    <span class="n">email_valid</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">while</span> <span class="n">email_valid</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">email</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Email Address: &#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">validation</span><span class="o">.</span><span class="n">Email</span><span class="p">(</span><span class="n">not_empty</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_python</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
            <span class="n">email_valid</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="n">validation</span><span class="o">.</span><span class="n">Invalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">e</span>
            <span class="k">print</span>
    <span class="k">print</span>
    <span class="n">pass_ok</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">pass_ok</span><span class="p">:</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s">&#39;Password: &#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">validation</span><span class="o">.</span><span class="n">SecurePassword</span><span class="o">.</span><span class="n">to_python</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">validation</span><span class="o">.</span><span class="n">Invalid</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">e</span>
            <span class="k">print</span>
            <span class="k">continue</span>
        <span class="n">password_confirm</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s">&#39;Confirm Password: &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">password</span> <span class="o">!=</span> <span class="n">password_confirm</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;passwords did not match&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pass_ok</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">register</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="set_encryption_passphrase"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.set_encryption_passphrase">[docs]</a><span class="k">def</span> <span class="nf">set_encryption_passphrase</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.client.node</span> <span class="kn">import</span> <span class="n">ClientNodeConfig</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">crypt</span>
    <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">ClientNodeConfig</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Enter a passphrase for your key. If you leave it blank &#39;</span>
           <span class="s">&#39;a random 128 bit passphrase will be created for you. &#39;</span>
           <span class="s">&#39;You will not see output as you type.&#39;</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">password_set</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">password_set</span><span class="p">:</span>
        <span class="n">pass1</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pass1</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">encrypt_passphrase</span> <span class="o">=</span> \
                <span class="n">crypt</span><span class="o">.</span><span class="n">stretch_passphrase</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span> <span class="n">output_format</span><span class="o">=</span><span class="s">&#39;base64&#39;</span>
                <span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;Generated a passphrase for you.&#39;</span>
            <span class="n">password_set</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pass2</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">pass2</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s">&#39;Confirm Passphrase: &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pass1</span> <span class="o">==</span> <span class="n">pass2</span><span class="p">:</span>
                <span class="c"># hash it</span>
                <span class="nb">hash</span> <span class="o">=</span> <span class="n">crypt</span><span class="o">.</span><span class="n">stretch_passphrase</span><span class="p">(</span>
                    <span class="n">pass2</span><span class="p">,</span> <span class="n">salt</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;node_id&#39;</span><span class="p">),</span> <span class="n">output_format</span><span class="o">=</span><span class="s">&#39;base64&#39;</span>
                <span class="p">)</span>
                <span class="n">config</span><span class="o">.</span><span class="n">encrypt_passphrase</span> <span class="o">=</span> <span class="nb">hash</span>
                <span class="n">password_set</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;A hash of your password was stored in your &#39;</span>
                       <span class="s">&#39;configuration file and will be &#39;</span>
                       <span class="s">&#39;used to generate encryption keys for your files. &#39;</span>
                       <span class="s">&#39;You should keep this hash safe because it can be used &#39;</span>
                       <span class="s">&#39;to decrypt your files.&#39;</span><span class="p">)</span>
                <span class="k">print</span>
                <span class="k">print</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span>
                <span class="k">print</span> <span class="s">&#39;Password Mismatch!&#39;</span>
                <span class="k">print</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">config</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="setup"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.setup">[docs]</a><span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">config_class</span><span class="p">,</span> <span class="n">node_factory</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.client.node</span> <span class="kn">import</span> <span class="n">ClientNodeConfig</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">config_class</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">print</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Your configuration file is located at </span><span class="si">%s</span><span class="s">. &#39;</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">config_path</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;You can edit the configuration file with a text editor.&#39;</span>
    <span class="k">print</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">print</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;node_id&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prompt_register</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
            <span class="n">raw_node_id</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Enter the Node ID assigned to you: &#39;</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;node_id&#39;</span><span class="p">,</span> <span class="n">raw_node_id</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;recert_code&#39;</span><span class="p">):</span>
        <span class="n">raw_recert_code</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Enter the Recert Code assigned to you: &#39;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;recert_code&#39;</span><span class="p">,</span> <span class="n">raw_recert_code</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">config_class</span> <span class="ow">is</span> <span class="n">ClientNodeConfig</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">encrypt_passphrase</span><span class="p">:</span>
        <span class="n">set_encryption_passphrase</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="c"># See if we have a cert.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">cert_path</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;Fetching your certificate.&#39;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">node_factory</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">request_new_certificate</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">encrypt_passphrase</span><span class="p">:</span>
        <span class="n">set_encryption_passphrase</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="setup_basic"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.setup_basic">[docs]</a><span class="k">def</span> <span class="nf">setup_basic</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Your configuration file is located at </span><span class="si">%s</span><span class="s">. &#39;</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">config_path</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;You can edit the configuration file with a text editor.&#39;</span>
    <span class="k">print</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">print</span>

    <span class="k">def</span> <span class="nf">setup_value</span><span class="p">(</span><span class="n">value_name</span><span class="p">,</span> <span class="n">value_text</span><span class="p">):</span>
        <span class="n">change</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value_name</span><span class="p">):</span>
            <span class="n">change</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Current value for &quot;</span><span class="si">%s</span><span class="s">&quot;: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">value_text</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value_name</span><span class="p">))</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">input_yesno</span><span class="p">(</span><span class="s">&#39;Change </span><span class="si">%s</span><span class="s">?&#39;</span> <span class="o">%</span> <span class="n">value_text</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="s">&#39;yes&#39;</span><span class="p">:</span>
                <span class="n">change</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">:</span>
            <span class="n">raw_node_id</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Enter value for </span><span class="si">%s</span><span class="s">: &#39;</span> <span class="o">%</span> <span class="n">value_text</span><span class="p">)</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value_name</span><span class="p">,</span> <span class="n">raw_node_id</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">config</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="c"># Node ID</span>
    <span class="n">setup_value</span><span class="p">(</span><span class="s">&#39;node_id&#39;</span><span class="p">,</span> <span class="s">&#39;Node ID&#39;</span><span class="p">)</span>
    <span class="k">print</span>

    <span class="c"># Cert Code</span>
    <span class="n">setup_value</span><span class="p">(</span><span class="s">&#39;recert_code&#39;</span><span class="p">,</span> <span class="s">&#39;Certificate Code&#39;</span><span class="p">)</span>
    <span class="k">print</span>

</div>
<div class="viewcode-block" id="setup_storage_node"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.setup_storage_node">[docs]</a><span class="k">def</span> <span class="nf">setup_storage_node</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.storage.node</span> <span class="kn">import</span> <span class="n">StorageNodeConfig</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">StorageNodeConfig</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">make_config</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">StorageNodeConfig</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&#39;created config at </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">config_path</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">setup_basic</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="setup_client_node"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.setup_client_node">[docs]</a><span class="k">def</span> <span class="nf">setup_client_node</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.client.node</span> <span class="kn">import</span> <span class="n">ClientNodeConfig</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">ClientNodeConfig</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">set_passphrase</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">encrypt_passphrase</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;A passphrase is already set. Are you sure you want &quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;to overwrite it?&quot;</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">input_yesno</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">answer</span> <span class="o">!=</span> <span class="s">&#39;yes&#39;</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="n">set_encryption_passphrase</span><span class="p">()</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">setup_basic</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">encrypt_passphrase</span><span class="p">:</span>
        <span class="n">set_encryption_passphrase</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="proxy_cmd"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.proxy_cmd">[docs]</a><span class="k">def</span> <span class="nf">proxy_cmd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;client&#39;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">new_cmd</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">verbosity</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;storage&#39;</span><span class="p">:</span>
                <span class="n">proxy</span> <span class="o">=</span> <span class="n">create_storage_node</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proxy</span> <span class="o">=</span> <span class="n">create_client_node</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                <span class="n">proxy</span><span class="o">.</span><span class="n">check_certificate</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s">&#39;Unable to Connect - There may be a problem with your network &#39;</span>
                <span class="s">&#39;connection or the host you are connecting to. &#39;</span>
                <span class="s">&#39;Error was: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">SBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_cmd</span>

</div>
<div class="viewcode-block" id="show_account"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.show_account">[docs]</a><span class="k">def</span> <span class="nf">show_account</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">show_account</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">response</span></div>
<span class="n">show_account</span> <span class="o">=</span> <span class="n">proxy_cmd</span><span class="p">(</span><span class="n">show_account</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;storage&#39;</span><span class="p">)</span>


<span class="nd">@proxy_cmd</span>
<div class="viewcode-block" id="list_volumes"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.list_volumes">[docs]</a><span class="k">def</span> <span class="nf">list_volumes</span><span class="p">(</span><span class="n">client_node</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client_node</span><span class="o">.</span><span class="n">list_volumes</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;Volume Information&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">10</span>
    <span class="k">print</span>
    <span class="k">print</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;Name&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="s">&#39;Mirrors&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="s">&#39;Bytes Stored&#39;</span>
    <span class="k">print</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;volumes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;  &#39;</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;* &#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">21</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;mirror_count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">11</span><span class="p">)),</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s">&#39;bytes_stored&#39;</span><span class="p">])),</span>
        <span class="k">print</span>

</div>
<span class="nd">@proxy_cmd</span>
<div class="viewcode-block" id="create_volume"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.create_volume">[docs]</a><span class="k">def</span> <span class="nf">create_volume</span><span class="p">(</span><span class="n">client_node</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client_node</span><span class="o">.</span><span class="n">create_volume</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">volume_name</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">mirror_count</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;message&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">]</span>

</div>
<span class="nd">@proxy_cmd</span>
<div class="viewcode-block" id="delete_volume"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.delete_volume">[docs]</a><span class="k">def</span> <span class="nf">delete_volume</span><span class="p">(</span><span class="n">client_node</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client_node</span><span class="o">.</span><span class="n">delete_volume</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">volume_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;message&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">]</span>

</div>
<span class="nd">@proxy_cmd</span>
<div class="viewcode-block" id="update_volume"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.update_volume">[docs]</a><span class="k">def</span> <span class="nf">update_volume</span><span class="p">(</span><span class="n">client_node</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client_node</span><span class="o">.</span><span class="n">update_volume</span><span class="p">(</span>
        <span class="n">args</span><span class="o">.</span><span class="n">volume_name</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">set_default</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">rename</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;message&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">]</span>

</div>
<span class="nd">@proxy_cmd</span>
<div class="viewcode-block" id="upload_file"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.upload_file">[docs]</a><span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span><span class="n">client_node</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">file_path</span>
    <span class="n">volume_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">volume_name</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">client_node</span><span class="o">.</span><span class="n">config</span>
    <span class="n">encrypt</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;encrypt&#39;</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="s">&#39;data_prep&#39;</span><span class="p">)</span>
    <span class="n">compress</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;compress&#39;</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="s">&#39;data_prep&#39;</span><span class="p">)</span>
    <span class="n">file_chunks_path</span> <span class="o">=</span> <span class="n">client_node</span><span class="o">.</span><span class="n">prepare_file</span><span class="p">(</span>
        <span class="n">file_path</span><span class="p">,</span> <span class="n">encrypt</span><span class="o">=</span><span class="n">encrypt</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="n">compress</span>
    <span class="p">)</span>
    <span class="n">client_node</span><span class="o">.</span><span class="n">upload_file_chunks</span><span class="p">(</span>
        <span class="n">file_chunks_path</span><span class="p">,</span> <span class="n">volume_name</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">file_name</span>
    <span class="p">)</span>

</div>
<span class="nd">@proxy_cmd</span>
<div class="viewcode-block" id="delete_file"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.delete_file">[docs]</a><span class="k">def</span> <span class="nf">delete_file</span><span class="p">(</span><span class="n">client_node</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">file_name</span>
    <span class="n">volume_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">volume_name</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client_node</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span>
        <span class="n">file_name</span><span class="p">,</span> <span class="n">volume_name</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;message&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">]</span>

</div>
<span class="nd">@proxy_cmd</span>
<div class="viewcode-block" id="download_file"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.download_file">[docs]</a><span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">client_node</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">file_name</span>
    <span class="n">volume_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">volume_name</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">output_path</span>
    <span class="n">overwrite_output</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">overwrite_output</span>
    <span class="n">client_node</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
        <span class="n">file_name</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">volume_name</span><span class="o">=</span><span class="n">volume_name</span><span class="p">,</span>
        <span class="n">overwrite_output</span><span class="o">=</span><span class="n">overwrite_output</span>
    <span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_format_column_data</span><span class="p">(</span><span class="n">column_data</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">column_data</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">row_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">column_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">col_widths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="n">row_length</span>

    <span class="k">def</span> <span class="nf">make_print_value</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">print_value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
            <span class="n">print_value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">print_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">print_value</span>
    <span class="c"># first, determine column widths and format data</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">column_data</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="n">print_value</span> <span class="o">=</span> <span class="n">make_print_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">print_value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">col_widths</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">col_widths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">print_value</span><span class="p">)</span>
    <span class="c"># add padding</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">column_data</span><span class="p">:</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="n">row_length</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="n">padding_size</span> <span class="o">=</span> <span class="n">col_widths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">print_value</span> <span class="o">=</span> <span class="n">make_print_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="c"># make integers align right</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">padded_value</span> <span class="o">=</span> <span class="n">print_value</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">padding_size</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">padded_value</span> <span class="o">=</span> <span class="n">print_value</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">padding_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">new_row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">padded_value</span>
        <span class="n">new_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_data</span>


<div class="viewcode-block" id="print_file_results"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.print_file_results">[docs]</a><span class="k">def</span> <span class="nf">print_file_results</span><span class="p">(</span><span class="n">file_results</span><span class="p">,</span> <span class="n">long_format</span><span class="p">,</span> <span class="n">with_metadata</span><span class="p">):</span>
    <span class="n">column_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">column_metadata</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rset</span> <span class="ow">in</span> <span class="n">file_results</span><span class="p">:</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># size, init time, flags, file name</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">rset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">with_metadata</span><span class="p">:</span>
            <span class="n">column_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[(</span><span class="s">&#39;    &#39;</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rset</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="p">)</span>
        <span class="n">column_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">column_data</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;no files&#39;</span>
        <span class="k">return</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_format_column_data</span><span class="p">(</span><span class="n">column_data</span><span class="p">)):</span>
        <span class="k">print</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">with_metadata</span> <span class="ow">and</span> <span class="n">column_metadata</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">_format_column_data</span><span class="p">(</span><span class="n">column_metadata</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="k">print</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

</div>
<span class="nd">@proxy_cmd</span>
<div class="viewcode-block" id="list_files"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.list_files">[docs]</a><span class="k">def</span> <span class="nf">list_files</span><span class="p">(</span><span class="n">client_node</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">volume_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">volume_name</span>
    <span class="n">long_format</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">long_format</span>
    <span class="n">with_metadata</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">with_metadata</span>
    <span class="n">detail_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">long_format</span><span class="p">:</span>
        <span class="n">detail_level</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">with_metadata</span><span class="p">:</span>
        <span class="n">detail_level</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">client_node</span><span class="o">.</span><span class="n">list_files</span><span class="p">(</span><span class="n">volume_name</span><span class="p">,</span> <span class="n">detail_level</span><span class="p">)</span>
    <span class="n">print_file_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">long_format</span><span class="p">,</span> <span class="n">with_metadata</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="match_type"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.match_type">[docs]</a><span class="k">def</span> <span class="nf">match_type</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;guess at type and coerce&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">util</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">matched_v</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c"># try int</span>
    <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">matched_v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="c"># try float:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">matched_v</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">matched_v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="c"># try dt</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">matched_v</span><span class="p">:</span>
        <span class="n">matched_v</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">datetime_from_string</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matched_v</span> <span class="ow">or</span> <span class="n">v</span>

</div>
<span class="nd">@proxy_cmd</span>
<div class="viewcode-block" id="find_files"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.find_files">[docs]</a><span class="k">def</span> <span class="nf">find_files</span><span class="p">(</span><span class="n">client_node</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">volume_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">volume_name</span>
    <span class="n">long_format</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">long_format</span>
    <span class="n">with_metadata</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">with_metadata</span>
    <span class="n">detail_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">long_format</span><span class="p">:</span>
        <span class="n">detail_level</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">with_metadata</span><span class="p">:</span>
        <span class="n">detail_level</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">OPS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;~&#39;</span><span class="p">,</span> <span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s">&#39;IS&#39;</span><span class="p">]</span>
    <span class="n">expr</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;AND&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">search_criteria</span><span class="p">:</span>
        <span class="n">found_op</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">OPS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">found_op</span> <span class="o">=</span> <span class="n">o</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">found_op</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">emsg</span> <span class="o">=</span> <span class="s">&#39;expected an operator for comparison:  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">m</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">SBValueError</span><span class="p">(</span><span class="n">emsg</span><span class="p">)</span>
        <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">found_op</span><span class="p">)</span>
        <span class="n">expr</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">found_op</span><span class="p">,</span> <span class="n">match_type</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">client_node</span><span class="o">.</span><span class="n">find_files</span><span class="p">(</span><span class="n">volume_name</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">detail_level</span><span class="p">)</span>
    <span class="n">print_file_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">long_format</span><span class="p">,</span> <span class="n">with_metadata</span><span class="p">)</span>

</div>
<span class="nd">@proxy_cmd</span>
<div class="viewcode-block" id="update_file"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.update_file">[docs]</a><span class="k">def</span> <span class="nf">update_file</span><span class="p">(</span><span class="n">client_node</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">file_name</span>
    <span class="n">volume_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">volume_name</span>

    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
        <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">match_type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">client_node</span><span class="o">.</span><span class="n">update_file</span><span class="p">(</span>
        <span class="n">volume_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">metadata</span>
    <span class="p">)</span>

</div>
<div class="viewcode-block" id="create_parsers"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.create_parsers">[docs]</a><span class="k">def</span> <span class="nf">create_parsers</span><span class="p">():</span>

    <span class="c"># see if config files exist</span>
    <span class="kn">from</span> <span class="nn">.storage.node</span> <span class="kn">import</span> <span class="n">StorageNodeConfig</span>
    <span class="n">storage_node_config_path</span> <span class="o">=</span> <span class="n">StorageNodeConfig</span><span class="o">.</span><span class="n">find_config_path</span><span class="p">()</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">version</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s">&#39;sbnet&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;version&#39;</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%(prog)s</span><span class="s"> &#39;</span> <span class="o">+</span> <span class="n">version</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--verbosity&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;level of output verbosity (0-3)&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="bp">None</span>
    <span class="p">)</span>
    <span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;sub-command help&#39;</span><span class="p">)</span>
    <span class="c"># storage node server</span>
    <span class="n">server_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;server&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;storage node server command&quot;</span>
    <span class="p">)</span>
    <span class="n">server_parsers</span> <span class="o">=</span> <span class="n">server_parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;server commands&#39;</span><span class="p">)</span>
    <span class="c"># storage node setup</span>
    <span class="n">storage_setup_parser</span> <span class="o">=</span> <span class="n">server_parsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;setup&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;configure storage node&#39;</span>
    <span class="p">)</span>
    <span class="n">storage_setup_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--make-config&#39;</span><span class="p">,</span> <span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;create a skeleton config only&#39;</span>
    <span class="p">)</span>
    <span class="n">storage_setup_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--set-node_id&#39;</span><span class="p">,</span> <span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;set node_id in config&#39;</span>
    <span class="p">)</span>
    <span class="n">storage_setup_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">setup_storage_node</span><span class="p">)</span>
    <span class="c"># start storage node</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">storage_node_config_path</span><span class="p">):</span>
        <span class="c"># server account</span>
        <span class="n">account_parser</span> <span class="o">=</span> <span class="n">server_parsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
            <span class="s">&#39;account&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;show account information&#39;</span>
        <span class="p">)</span>
        <span class="n">account_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">show_account</span><span class="p">)</span>
        <span class="n">start_server_parser</span> <span class="o">=</span> <span class="n">server_parsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
            <span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;startup storage node server&#39;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">daemon</span><span class="p">:</span>
            <span class="n">start_server_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                <span class="s">&#39;--nodaemon&#39;</span><span class="p">,</span> <span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s">&#39;do not daemonize process&#39;</span>
            <span class="p">)</span>
        <span class="n">start_server_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">start_server</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">daemon</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">storage_node_config_path</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">signal</span>
        <span class="n">daemon_pid_file_path</span> <span class="o">=</span> <span class="n">get_daemon_pid</span><span class="p">(</span><span class="n">storage_node_config_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">daemon_pid_file_path</span><span class="p">:</span>
            <span class="n">shutdown_parser</span> <span class="o">=</span> <span class="n">server_parsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
                <span class="s">&#39;stop&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;shutdown storage node server&#39;</span>
            <span class="p">)</span>

            <span class="k">def</span> <span class="nf">shutdown_storage_node</span><span class="p">(</span><span class="n">parser_args</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&#39;sending process TERM signal&#39;</span>
                <span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">daemon_pid_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()),</span>
                    <span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span>
                <span class="p">)</span>
            <span class="n">shutdown_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">shutdown_storage_node</span><span class="p">)</span>
    <span class="n">client_setup_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;setup&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;configure client node&#39;</span>
    <span class="p">)</span>
    <span class="n">client_setup_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--make-config&#39;</span><span class="p">,</span> <span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;create a skeleton config only&#39;</span>
    <span class="p">)</span>
    <span class="n">client_setup_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--set-passphrase&#39;</span><span class="p">,</span> <span class="s">&#39;-p&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;set the encryption passphrase&#39;</span>
    <span class="p">)</span>
    <span class="n">client_setup_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">setup_client_node</span><span class="p">)</span>
    <span class="c"># list volumes</span>
    <span class="n">list_volume_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;list-volumes&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;list volumes&#39;</span>
    <span class="p">)</span>
    <span class="n">list_volume_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">list_volumes</span><span class="p">)</span>
    <span class="c"># create volume</span>
    <span class="n">create_volume_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;create-volume&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;create a new volume&#39;</span>
    <span class="p">)</span>
    <span class="n">create_volume_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;volume_name&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;volume name&#39;</span>
    <span class="p">)</span>
    <span class="n">create_volume_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--mirror-count&#39;</span><span class="p">,</span> <span class="s">&#39;-m&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;number of mirrors&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">create_volume_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">create_volume</span><span class="p">)</span>
    <span class="c"># delete volume</span>
    <span class="n">delete_volume_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;delete-volume&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;delete a volume&#39;</span>
    <span class="p">)</span>
    <span class="n">delete_volume_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;volume_name&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;volume name&#39;</span>
    <span class="p">)</span>
    <span class="n">delete_volume_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">delete_volume</span><span class="p">)</span>
    <span class="c"># update volume</span>
    <span class="n">update_volume_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;update-volume&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;update a volume&#39;</span>
    <span class="p">)</span>
    <span class="n">update_volume_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;volume_name&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;volume name&#39;</span>
    <span class="p">)</span>
    <span class="n">update_volume_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--set-default&#39;</span><span class="p">,</span> <span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;set as default volume&#39;</span>
    <span class="p">)</span>
    <span class="n">update_volume_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--rename&#39;</span><span class="p">,</span> <span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;rename the volume&#39;</span>
    <span class="p">)</span>
    <span class="n">update_volume_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">update_volume</span><span class="p">)</span>
    <span class="c"># upload file</span>
    <span class="n">upload_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;upload&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;upload a file&#39;</span>
    <span class="p">)</span>
    <span class="n">upload_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;file_path&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;path to the file&#39;</span>
    <span class="p">)</span>
    <span class="n">upload_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--volume-name&#39;</span><span class="p">,</span> <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;volume to put the file on&#39;</span>
    <span class="p">)</span>
    <span class="n">upload_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--file-name&#39;</span><span class="p">,</span> <span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;name to refernece this file with&#39;</span>
    <span class="p">)</span>
    <span class="n">upload_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">upload_file</span><span class="p">)</span>
    <span class="c"># delete file</span>
    <span class="n">delete_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;delete&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;delete a file&#39;</span>
    <span class="p">)</span>
    <span class="n">delete_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;file_name&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;name of the file to delete&#39;</span>
    <span class="p">)</span>
    <span class="n">delete_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--volume-name&#39;</span><span class="p">,</span> <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;volume on which the file resides&#39;</span>
    <span class="p">)</span>
    <span class="n">delete_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">delete_file</span><span class="p">)</span>
    <span class="c"># download file</span>
    <span class="n">download_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;download&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;download a file&#39;</span>
    <span class="p">)</span>
    <span class="n">download_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;file_name&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;name of the file to download&#39;</span>
    <span class="p">)</span>
    <span class="n">download_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;output_path&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">download_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--overwrite-output&#39;</span><span class="p">,</span> <span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;overwrite file at output_path if exists&#39;</span>
    <span class="p">)</span>
    <span class="n">download_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--volume-name&#39;</span><span class="p">,</span> <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;volume on which the file resides&#39;</span>
    <span class="p">)</span>
    <span class="n">download_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">download_file</span><span class="p">)</span>
    <span class="c"># list files</span>
    <span class="n">list_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;list&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;list all files&#39;</span>
    <span class="p">)</span>
    <span class="n">list_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--volume-name&#39;</span><span class="p">,</span> <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;volume on which to list files&#39;</span>
    <span class="p">)</span>
    <span class="n">list_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--long-format&#39;</span><span class="p">,</span> <span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;show init date, size and flags&#39;</span>
    <span class="p">)</span>
    <span class="n">list_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--with-metadata&#39;</span><span class="p">,</span> <span class="s">&#39;-m&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;include metadata&#39;</span>
    <span class="p">)</span>
    <span class="n">list_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">list_files</span><span class="p">)</span>
    <span class="c"># search files</span>
    <span class="n">find_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;find&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;find files&#39;</span>
    <span class="p">)</span>
    <span class="n">find_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--volume-name&#39;</span><span class="p">,</span> <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;volume on which to search files&#39;</span>
    <span class="p">)</span>
    <span class="n">find_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--long-format&#39;</span><span class="p">,</span> <span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;show init date, size and flags&#39;</span>
    <span class="p">)</span>
    <span class="n">find_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--with-metadata&#39;</span><span class="p">,</span> <span class="s">&#39;-m&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;include metadata&#39;</span>
    <span class="p">)</span>
    <span class="n">find_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;search_criteria&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;criteria for search&#39;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;*&#39;</span>
    <span class="p">)</span>
    <span class="n">find_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">find_files</span><span class="p">)</span>
    <span class="c"># update file</span>
    <span class="n">file_update_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
        <span class="s">&#39;update&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;update file metadata&#39;</span>
    <span class="p">)</span>
    <span class="n">file_update_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;file_name&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;filename to update&#39;</span>
    <span class="p">)</span>
    <span class="n">file_update_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--volume-name&#39;</span><span class="p">,</span> <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;volume on which file resides&#39;</span>
    <span class="p">)</span>
    <span class="n">file_update_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--metadata&#39;</span><span class="p">,</span> <span class="s">&#39;-m&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;update metadata&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;*&#39;</span>
    <span class="p">)</span>
    <span class="n">file_update_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">update_file</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span>

</div>
<div class="viewcode-block" id="run"><a class="viewcode-back" href="../../apidoc/scatterbytes.html#scatterbytes.cli.run">[docs]</a><span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">create_parsers</span><span class="p">()</span>
    <span class="n">argcomplete</span><span class="o">.</span><span class="n">autocomplete</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">args</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></div>
</pre></div>

      </div>
      <div class="bottomnav">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, Randall Smith.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>